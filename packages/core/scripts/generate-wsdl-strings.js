const fs = require("fs");
const path = require("path");

const wsdlDir = path.join(
  __dirname,
  "../src/infrastructure/outbound/adapters/soap/wsdl"
);
const outputFile = path.join(
  __dirname,
  "../src/infrastructure/outbound/adapters/soap/wsdl-strings.ts"
);

const header = `/**
 * WSDL files embedded as strings
 * This file is auto-generated to avoid file system access issues in bundled environments
 * Generated from files in src/infrastructure/outbound/adapters/soap/wsdl/
 * 
 * DO NOT EDIT THIS FILE MANUALLY
 * Run: npm run generate:wsdl-strings
 */

export const WSDL_STRINGS: Record<string, string> = {
`;

const footer = `};

export function getWsdlString(wsdlName: string): string | undefined {
  return WSDL_STRINGS[wsdlName];
}
`;

function generate() {
  console.log("Generating wsdl-strings.ts...");

  if (!fs.existsSync(wsdlDir)) {
    console.error(`WSDL directory not found: ${wsdlDir}`);
    process.exit(1);
  }

  const files = fs
    .readdirSync(wsdlDir)
    .filter((file) => file.endsWith(".wsdl"));
  let content = header;

  files.forEach((file, index) => {
    const filePath = path.join(wsdlDir, file);
    const fileContent = fs.readFileSync(filePath, "utf8");

    // Escape backticks in the content if any (though unlikely in XML)
    const escapedContent = fileContent
      .replace(/`/g, "\\`")
      .replace(/\${/g, "\\${");

    content += `  '${file}': \`${escapedContent}\``;

    if (index < files.length - 1) {
      content += ",\n";
    } else {
      content += "\n";
    }
  });

  content += footer;

  fs.writeFileSync(outputFile, content);
  console.log(`Successfully generated ${outputFile}`);
}

generate();
